package ai.pentest.ptt;

import java.util.regex.Pattern;

/**
 * Passive signal patterns used to score nodes.
 * Tailored for DVWA and Juice Shop vulnerability detection.
 */
public class EvidencePatterns {
	// SQL error messages commonly reflected by backends (DVWA style)
	public static final Pattern SQL_ERROR = Pattern.compile("(?i)(syntax error|unclosed quotation|SQLSTATE|ORA-\\d+|mysql_fetch|pg_query|mysql error|you have an error in your sql|warning: mysql|mysqli_query|sqlite3|postgresql error)\\b");
	// Verbose JSON fields that often indicate exposure of sensitive properties
	public static final Pattern VERBOSE_JSON = Pattern.compile("\\\"(password|token|secret|role|isAdmin(?:User)?|email|phone|creditCard|cardNumber|ssn)\\\"\\s*:\\s*(?=\\\"|')[^,}]+");
	// UUID patterns (common in Juice Shop)
	public static final Pattern UUID_IN_BODY = Pattern.compile("[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}");
	public static final Pattern UUID_IN_PATH = Pattern.compile("/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}(?:/|\\?|$)");
	// Parameters indicative of SSRF-style inputs
	public static final Pattern URL_PARAM_NAME = Pattern.compile("(?i)(url=|target=|callback=|redirect=|feed=|endpoint=|link=|uri=)(?![a-z/]+\\.(jpg|png|css|js|gif|svg|ico))");
	// Paths indicative of privileged/function-level resources
	public static final Pattern ADMIN_PATH = Pattern.compile("(?i)(/admin|/internal|/manage|/root|/administrator|/dashboard)");
	// Versioned API paths (inventory/versioning hints)
	public static final Pattern VERSION_PATH = Pattern.compile("(?i)(/v[0-9]+/|/api/v[0-9]+/)");
	// Session ID patterns (DVWA/Juice Shop)
	public static final Pattern SESSION_ID = Pattern.compile("(?:session|sess|sid|jsessionid|phpsessid|connect\\.sid)=([a-zA-Z0-9]{8,})");
	// JWT token pattern (Juice Shop)
	public static final Pattern JWT_TOKEN = Pattern.compile("Bearer ([A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+)");
	// Sensitive fields in responses
	public static final Pattern SENSITIVE_FIELD = Pattern.compile("\"(?:email|phone|ssn|creditCard|cardNumber|password|token|secret|apikey|apiKey|accessToken|refreshToken)\"\\s*:\\s*\"[^\"]+\"");
	// CORS wildcard pattern
	public static final Pattern CORS_WILDCARD = Pattern.compile("(?i)access-control-allow-origin:\\s*\\*");
	// Debug/development headers
	public static final Pattern DEBUG_HEADER = Pattern.compile("(?i)x-debug[^:]*:|x-debug-token:");
	// BOLA indicators - resource paths (Juice Shop: basket, order, product)
	public static final Pattern RESOURCE_PATH = Pattern.compile("/(?:basket|order|product|invoice|document|file|message|notification|cart|wishlist)/\\d+");
	// BOLA indicators - user-oriented paths
	public static final Pattern USER_PATH = Pattern.compile("/(?:user|profile|account|customer|member|client|employee|me|self|current)/");
	// BOLA indicators - hierarchical resources
	public static final Pattern HIERARCHICAL_PATH = Pattern.compile("/(?:company|organization|tenant|project|workspace)/\\d+/");
	// DVWA-specific paths
	public static final Pattern DVWA_PATH = Pattern.compile("/(?:vulnerabilities|security|setup)\\.php");
	// Stack trace patterns (DVWA error disclosure)
	public static final Pattern STACK_TRACE = Pattern.compile("(?i)(?:stack trace|exception|error at|at \\w+\\.java|at \\w+\\.php|file:|line \\d+|traceback|trace:|fatal error)");
}


