package ai.pentest.ptt;

import java.util.ArrayList;
import java.util.List;

/**
 * Minimal, pluggable scaffolds mapping heuristics -> sub-branches for OWASP categories.
 * This is intentionally concise; extend with organization-specific playbooks.
 */
public class CategoryScaffolds {

    public static List<PTTNode> buildBOLA(String baseId) {
        List<PTTNode> list = new ArrayList<>();
		PTTNode idTamper = new PTTNode(baseId+"/bola-id", "API1/BOLA: ID Tampering", "API1:2023", "numeric-id");
		idTamper.addChild(new PTTNode(baseId+"/bola-id/seq", "Enumerate Sequential IDs", "API1:2023", "sequence", idTamper.getId(), "Check ID+1 response", "Diff in data"));
		idTamper.addChild(new PTTNode(baseId+"/bola-id/uuid", "Probe UUID Scope", "API1:2023", "uuid-scope", idTamper.getId(), "UUID in body/path", "Scope mismatch"));
		idTamper.addChild(new PTTNode(baseId+"/bola-id/basket", "Basket/Order ID Tampering", "API1:2023", "basket-order", idTamper.getId(), "Juice Shop: /rest/basket/{id} or /rest/order/{id}", "Access other user's basket/order"));
		idTamper.addChild(new PTTNode(baseId+"/bola-id/product", "Product ID Tampering", "API1:2023", "product-id", idTamper.getId(), "Juice Shop: /rest/products/{id}", "Unauthorized product access"));
        list.add(idTamper);

        PTTNode roleEsc = new PTTNode(baseId+"/bola-role", "API1/BOLA: Role Escalation", "API1:2023", "role-heuristic");
        roleEsc.addChild(new PTTNode(baseId+"/bola-role/admin", "Admin Role Exposure", "API1:2023", "admin-role", roleEsc.getId(), "Check for role field in response", "Role escalation to admin"));
        list.add(roleEsc);
        return list;
    }

    public static List<PTTNode> buildExcessiveData(String baseId) {
        List<PTTNode> list = new ArrayList<>();
        PTTNode verbose = new PTTNode(baseId+"/api4-verbose", "API4: Excessive Data Exposure", "API4:2023", "verbose-json");
        verbose.addChild(new PTTNode(baseId+"/api4-massassign", "API6: Mass Assignment Candidate", "API6:2023", "overexposed-fields"));
        list.add(verbose);
        return list;
    }

    public static List<PTTNode> buildBrokenAuth(String baseId) {
        List<PTTNode> list = new ArrayList<>();
		PTTNode ba = new PTTNode(baseId+"/api2-broken-auth", "API2: Broken Authentication", "API2:2023", "auth-gaps");
		ba.addChild(new PTTNode(baseId+"/api2-session", "Session Weaknesses", "API2:2023", "session", ba.getId(), "Review cookie/token flags", "Missing HttpOnly/SameSite"));
		ba.addChild(new PTTNode(baseId+"/api2-token", "Token Handling Issues", "API2:2023", "token", ba.getId(), "Check static API keys", "Hardcoded key in query"));
        list.add(ba);
        return list;
    }

    public static List<PTTNode> buildPropertyLevelAuth(String baseId) {
        List<PTTNode> list = new ArrayList<>();
        PTTNode opla = new PTTNode(baseId+"/api3-opla", "API3: Property Level Authorization", "API3:2023", "fields");
        opla.addChild(new PTTNode(baseId+"/api3-hidden", "Hidden/Sensitive Fields Exposed", "API3:2023", "exposure"));
        list.add(opla);
        return list;
    }

    public static List<PTTNode> buildResourceConsumption(String baseId) {
        List<PTTNode> list = new ArrayList<>();
        PTTNode rc = new PTTNode(baseId+"/api4-urc", "API4: Unrestricted Resource Consumption", "API4:2023", "limits");
        list.add(rc);
        return list;
    }

    public static List<PTTNode> buildFunctionLevelAuth(String baseId) {
        List<PTTNode> list = new ArrayList<>();
        PTTNode bfla = new PTTNode(baseId+"/api5-bfla", "API5: Function Level Authorization", "API5:2023", "admin-internal");
        list.add(bfla);
        return list;
    }

    public static List<PTTNode> buildBusinessFlows(String baseId) {
        List<PTTNode> list = new ArrayList<>();
        PTTNode flows = new PTTNode(baseId+"/api6-flows", "API6: Unrestricted Access to Sensitive Business Flows", "API6:2023", "automation");
        list.add(flows);
        return list;
    }

    public static List<PTTNode> buildSSRF(String baseId) {
        List<PTTNode> list = new ArrayList<>();
		PTTNode ssrf = new PTTNode(baseId+"/api7-ssrf", "API7: SSRF", "API7:2023", "url-params");
		ssrf.addChild(new PTTNode(baseId+"/api7-callback", "Locate Callback Parameters", "API7:2023", "callback-param", ssrf.getId(), "Find url/target inputs", "Potential server fetch"));
		ssrf.addChild(new PTTNode(baseId+"/api7-dns", "DNS/Metadata Probing (passive)", "API7:2023", "metadata", ssrf.getId(), "Check 169.254/metadata refs", "Instance metadata leak"));
        list.add(ssrf);
        return list;
    }

    public static List<PTTNode> buildSecurityMisconfig(String baseId) {
        List<PTTNode> list = new ArrayList<>();
        PTTNode mis = new PTTNode(baseId+"/api8-misconf", "API8: Security Misconfiguration", "API8:2023", "headers");
        list.add(mis);
        return list;
    }

    public static List<PTTNode> buildInventory(String baseId) {
        List<PTTNode> list = new ArrayList<>();
        PTTNode inv = new PTTNode(baseId+"/api9-inventory", "API9: Improper Inventory Management", "API9:2023", "versions");
        list.add(inv);
        return list;
    }

    public static List<PTTNode> buildUnsafeConsumption(String baseId) {
        List<PTTNode> list = new ArrayList<>();
        PTTNode uc = new PTTNode(baseId+"/api10-unsafe", "API10: Unsafe Consumption of APIs", "API10:2023", "trust-external");
        list.add(uc);
        return list;
    }
}


