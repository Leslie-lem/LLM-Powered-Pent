package ai.pentest.ui;

import javax.swing.*;
import java.awt.*;
import java.awt.geom.Line2D;
import java.util.ArrayList;
import java.util.List;
import java.util.Random;

/**
 * Custom background panel with penetration testing/cybersecurity visual theme.
 * Displays animated network connections, code-like patterns, and tech aesthetics.
 */
public class TechBackgroundPanel extends JPanel {
    
    private final List<NetworkNode> nodes = new ArrayList<>();
    private final List<Connection> connections = new ArrayList<>();
    private final Random random = new Random();
    private Timer animationTimer;
    
    public TechBackgroundPanel() {
        setOpaque(false);
        initializeNodes();
        startAnimation();
    }
    
    private void initializeNodes() {
        // Create network nodes for visual effect
        for (int i = 0; i < 15; i++) {
            nodes.add(new NetworkNode(
                random.nextDouble() * 1000,
                random.nextDouble() * 600,
                random.nextDouble() * 2 + 1
            ));
        }
        
        // Create connections between nearby nodes
        for (int i = 0; i < nodes.size(); i++) {
            for (int j = i + 1; j < nodes.size(); j++) {
                NetworkNode n1 = nodes.get(i);
                NetworkNode n2 = nodes.get(j);
                double dist = Math.sqrt(
                    Math.pow(n1.x - n2.x, 2) + Math.pow(n1.y - n2.y, 2)
                );
                if (dist < 200) {
                    connections.add(new Connection(n1, n2, dist));
                }
            }
        }
    }
    
    private void startAnimation() {
        animationTimer = new Timer(50, e -> {
            // Subtle animation - slow movement
            for (NetworkNode node : nodes) {
                node.x += (random.nextDouble() - 0.5) * 0.5;
                node.y += (random.nextDouble() - 0.5) * 0.5;
                // Keep nodes in bounds
                node.x = Math.max(0, Math.min(1000, node.x));
                node.y = Math.max(0, Math.min(600, node.y));
            }
            repaint();
        });
        animationTimer.start();
    }
    
    @Override
    protected void paintComponent(Graphics g) {
        super.paintComponent(g);
        Graphics2D g2d = (Graphics2D) g.create();
        g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
        g2d.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_QUALITY);
        
        int width = getWidth();
        int height = getHeight();
        
        // Scale nodes to current panel size
        double scaleX = width / 1000.0;
        double scaleY = height / 600.0;
        
        // Draw connections (network lines)
        g2d.setStroke(new BasicStroke(1.0f, BasicStroke.CAP_ROUND, BasicStroke.JOIN_ROUND));
        for (Connection conn : connections) {
            float alpha = (float) (0.1 + (1.0 - conn.distance / 200.0) * 0.2);
            g2d.setColor(new Color(UITheme.ACCENT_PRIMARY.getRed(), 
                                  UITheme.ACCENT_PRIMARY.getGreen(), 
                                  UITheme.ACCENT_PRIMARY.getBlue(), 
                                  (int)(alpha * 255)));
            g2d.draw(new Line2D.Double(
                conn.node1.x * scaleX, conn.node1.y * scaleY,
                conn.node2.x * scaleX, conn.node2.y * scaleY
            ));
        }
        
        // Draw nodes (network points)
        for (NetworkNode node : nodes) {
            float alpha = 0.3f;
            g2d.setColor(new Color(UITheme.ACCENT_PRIMARY.getRed(), 
                                  UITheme.ACCENT_PRIMARY.getGreen(), 
                                  UITheme.ACCENT_PRIMARY.getBlue(), 
                                  (int)(alpha * 255)));
            int size = (int)(node.size * 3);
            g2d.fillOval(
                (int)(node.x * scaleX) - size/2,
                (int)(node.y * scaleY) - size/2,
                size, size
            );
        }
        
        // Draw code-like patterns (subtle)
        g2d.setFont(UITheme.FONT_MONO);
        g2d.setColor(new Color(UITheme.TEXT_MUTED.getRed(), 
                              UITheme.TEXT_MUTED.getGreen(), 
                              UITheme.TEXT_MUTED.getBlue(), 
                              30));
        for (int i = 0; i < 20; i++) {
            String code = generateCodeSnippet();
            g2d.drawString(code, 
                random.nextInt(width), 
                random.nextInt(height));
        }
        
        g2d.dispose();
    }
    
    private String generateCodeSnippet() {
        String[] snippets = {
            "if (vuln.check())",
            "scan.endpoint()",
            "auth.verify()",
            "payload.execute()",
            "response.analyze()",
            "token.validate()",
            "session.hijack()",
            "sql.inject()"
        };
        return snippets[random.nextInt(snippets.length)];
    }
    
    private static class NetworkNode {
        double x, y, size;
        NetworkNode(double x, double y, double size) {
            this.x = x;
            this.y = y;
            this.size = size;
        }
    }
    
    private static class Connection {
        NetworkNode node1, node2;
        double distance;
        Connection(NetworkNode n1, NetworkNode n2, double dist) {
            this.node1 = n1;
            this.node2 = n2;
            this.distance = dist;
        }
    }
    
    public void stopAnimation() {
        if (animationTimer != null) {
            animationTimer.stop();
        }
    }
}

